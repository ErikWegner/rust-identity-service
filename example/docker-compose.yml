name: example-ridser

services:
  ridser:
    # https://mcr.microsoft.com/v2/vscode/devcontainers/rust/tags/list
    image: erikwegner/ridser:2.0.0
    ports:
      # Publish keycloak here, because network stack is shared
      - "8101:8101"
      - "3000:3000"
    volumes:
      # Mount the root folder that contains .git
      - ..:/files:ro
      - ../.env.default:/.env:ro

  redis:
    image: redis:7-alpine

  echo:
    image: erikwegner/rsecho:release-1.0.0

  keycloak:
    image: quay.io/keycloak/keycloak:25.0.1
    command:
      - start-dev
      - --import-realm
    # Use the network stack of another container, specified via its name
    # https://docs.docker.com/engine/reference/run/#network-settings
    network_mode: "service:ridser"
    environment:
      - KEYCLOAK_ADMIN=admin
      - KEYCLOAK_ADMIN_PASSWORD=admin
      - KC_HTTP_PORT=8101
    volumes:
      - ../dev_realm.json:/opt/keycloak/data/import/dev_realm.json
